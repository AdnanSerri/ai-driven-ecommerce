# ML Service Documentation

## Personalized Product Recommendation System

### Ù†Ø¸Ø§Ù… ØªÙˆØµÙŠØ© Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ø®ØµØµ Ø­Ø³Ø¨ Ø´Ø®ØµÙŠØ© Ø§Ù„Ø¹Ù…ÙŠÙ„

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [What is the ML Service?](#2-what-is-the-ml-service)
3. [Why Do We Need It?](#3-why-do-we-need-it)
4. [System Architecture](#4-system-architecture)
5. [Core Components](#5-core-components)
6. [Data Flow](#6-data-flow)
7. [Sentiment Analysis Module](#7-sentiment-analysis-module)
8. [Personality Classification Module](#8-personality-classification-module)
9. [Recommendation Engine](#9-recommendation-engine)
10. [Database Connections](#10-database-connections)
11. [API Specifications](#11-api-specifications)
12. [Required Libraries](#12-required-libraries-and-dependencies)
13. [Environment Configuration](#13-environment-configuration)
14. [Project Structure](#14-project-structure)
15. [Integration with Laravel](#15-integration-with-laravel)
16. [Machine Learning Models](#16-machine-learning-models)
17. [Performance Considerations](#17-performance-considerations)
18. [Security Considerations](#18-security-considerations)
19. [Testing Strategy](#19-testing-strategy)
20. [Deployment Guide](#20-deployment-guide)
21. [Future Enhancements](#21-future-enhancements)

---

# 1. Executive Summary

The ML Service is the **intelligent brain** of our product recommendation system. It is a standalone Python microservice built with FastAPI that handles all machine learning operations including:

- **Sentiment Analysis** of customer reviews
- **Personality Classification** based on purchasing behavior
- **Personalized Product Recommendations**

## Key Highlights

| Aspect            | Description                                          |
| ----------------- | ---------------------------------------------------- |
| **Architecture**  | Standalone Python microservice (FastAPI)             |
| **Communication** | REST API with Laravel backend                        |
| **Databases**     | MongoDB, Weaviate, PostgreSQL (read-only + interaction logs) |
| **ML Models**     | Hugging Face Transformers, scikit-learn, implicit    |
| **Purpose**       | Transform raw user data into actionable insights     |

## What It Does

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ML SERVICE CAPABILITIES                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   RAW DATA                         ACTIONABLE INSIGHTS          â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€                        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”‚
â”‚                                                                  â”‚
â”‚   Customer Reviews     â”€â”€â”€â”€â”€â”€â–¶     Sentiment Scores             â”‚
â”‚   "Great product!"                 score: 0.92, label: positive â”‚
â”‚                                                                  â”‚
â”‚   Purchase History     â”€â”€â”€â”€â”€â”€â–¶     Personality Profile          â”‚
â”‚   [Electronics, Books]             type: "Adventurous Premium"  â”‚
â”‚                                                                  â”‚
â”‚   User Behavior        â”€â”€â”€â”€â”€â”€â–¶     Recommendations              â”‚
â”‚   Clicks, Views, Time              "You might like Product X"   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Why Separate from Laravel?

1. **Python ML Ecosystem** â€” TensorFlow, PyTorch, scikit-learn have no PHP equivalents
2. **Independent Scaling** â€” ML is resource-intensive, scale separately
3. **Team Specialization** â€” Data scientists work independently
4. **Model Flexibility** â€” Update models without touching Laravel

---

# 2. What is the ML Service?

## 2.1 Definition

The ML Service is a **Python-based microservice** that encapsulates all artificial intelligence and machine learning functionality. It serves as the computational engine that transforms raw user data into actionable insights.

## 2.2 Core Functions

| Function                       | Description                          | Input                                   | Output                    |
| ------------------------------ | ------------------------------------ | --------------------------------------- | ------------------------- |
| **Sentiment Analysis**         | Analyzes emotional tone of reviews   | Review text                             | Score (-1 to 1) + Label   |
| **Personality Classification** | Determines customer personality type | Purchase history, reviews, interactions | Personality type + Traits |
| **Recommendation Generation**  | Produces personalized suggestions    | User profile, product catalog           | Ranked product list       |
| **Profile Management**         | Creates/updates user profiles        | User activity data                      | MongoDB profile document  |
| **Vector Operations**          | Embedding generation & similarity    | Product/user data                       | Vector embeddings         |

## 2.3 Technology Stack

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      TECHNOLOGY STACK                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  LAYER              TECHNOLOGY           PURPOSE                â”‚
â”‚  â”€â”€â”€â”€â”€              â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”€â”€â”€â”€â”€â”€â”€                â”‚
â”‚                                                                  â”‚
â”‚  Framework          FastAPI              High-performance API   â”‚
â”‚  Language           Python 3.11+         ML ecosystem           â”‚
â”‚  ML Framework       PyTorch              Deep learning          â”‚
â”‚  NLP                Hugging Face         Pre-trained models     â”‚
â”‚  Data Processing    Pandas, NumPy        Data manipulation      â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ DATABASES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”‚
â”‚                                                                  â”‚
â”‚  MongoDB            User profiles, ML features                  â”‚
â”‚  Weaviate           Vector embeddings, similarity search        â”‚
â”‚  PostgreSQL         Business data + interaction logging          â”‚
â”‚  Redis              Caching, rate limiting                      â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 2.4 Service Boundaries

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                         â”‚
â”‚  LARAVEL HANDLES:                    ML SERVICE HANDLES:               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                â”‚
â”‚                                                                         â”‚
â”‚  âœ“ User Authentication               âœ“ Sentiment Analysis              â”‚
â”‚  âœ“ Product Management                âœ“ Personality Classification      â”‚
â”‚  âœ“ Order Processing                  âœ“ Recommendation Generation       â”‚
â”‚  âœ“ Review Storage                    âœ“ Vector Embeddings               â”‚
â”‚  âœ“ API Gateway                       âœ“ ML Model Inference              â”‚
â”‚  âœ“ Session Management                âœ“ Profile Computation             â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

# 3. Why Do We Need It?

## 3.1 The Problem We're Solving

Traditional e-commerce recommendation systems suffer from critical limitations:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PROBLEMS WITH TRADITIONAL SYSTEMS             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  âŒ GENERIC RECOMMENDATIONS                                      â”‚
â”‚     Same popular products shown to everyone                     â”‚
â”‚     No personalization based on individual preferences          â”‚
â”‚                                                                  â”‚
â”‚  âŒ NO EMOTIONAL UNDERSTANDING                                   â”‚
â”‚     Systems don't consider HOW customers feel about products    â”‚
â”‚     A 3-star "it's okay" vs 3-star "disappointed" are equal    â”‚
â”‚                                                                  â”‚
â”‚  âŒ STATIC PROFILING                                             â”‚
â”‚     User profiles don't evolve with changing preferences        â”‚
â”‚     Yesterday's interests drive today's recommendations         â”‚
â”‚                                                                  â”‚
â”‚  âŒ COLD START PROBLEM                                           â”‚
â”‚     New users receive poor/random recommendations               â”‚
â”‚     No data = no personalization                                â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 3.2 Our Solution

| Problem                    | Our Solution                                                             |
| -------------------------- | ------------------------------------------------------------------------ |
| Generic recommendations    | **Personality-based filtering** that understands individual preferences  |
| No emotional understanding | **Sentiment analysis** that captures how users truly feel about products |
| Static profiling           | **Dynamic profiles** that update with every interaction                  |
| Cold start problem         | **Hybrid approach** combining collaborative + content-based + popularity |

## 3.3 Business Value

### For the Business:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      BUSINESS BENEFITS                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  ğŸ“ˆ INCREASED CONVERSION RATES                                   â”‚
â”‚     Relevant recommendations = More purchases                   â”‚
â”‚                                                                  â”‚
â”‚  ğŸ˜Š HIGHER CUSTOMER SATISFACTION                                 â”‚
â”‚     Users feel understood = Better retention                    â”‚
â”‚                                                                  â”‚
â”‚  ğŸ“Š BETTER CUSTOMER INSIGHTS                                     â”‚
â”‚     Understand customer segments and behaviors                  â”‚
â”‚                                                                  â”‚
â”‚  ğŸ¯ DATA-DRIVEN DECISIONS                                        â”‚
â”‚     Product placement based on real data, not guesses           â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### For Customers:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CUSTOMER BENEFITS                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  ğŸ PERSONALIZED EXPERIENCE                                      â”‚
â”‚     Products tailored to individual taste                       â”‚
â”‚                                                                  â”‚
â”‚  ğŸ” PRODUCT DISCOVERY                                            â”‚
â”‚     Find products matching their personality                    â”‚
â”‚                                                                  â”‚
â”‚  â±ï¸ TIME SAVED                                                   â”‚
â”‚     Less searching, more relevant results                       â”‚
â”‚                                                                  â”‚
â”‚  ğŸ’ FEELING VALUED                                               â”‚
â”‚     System understands and remembers preferences                â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 3.4 Technical Justification

### Why a Separate Microservice?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              WHY NOT JUST BUILD IT IN LARAVEL?                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  1. LANGUAGE OPTIMIZATION                                       â”‚
â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                       â”‚
â”‚     Python has TensorFlow, PyTorch, scikit-learn, Hugging Face â”‚
â”‚     PHP has... nothing comparable for ML                        â”‚
â”‚                                                                  â”‚
â”‚  2. INDEPENDENT SCALING                                         â”‚
â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                         â”‚
â”‚     ML is CPU/GPU intensive                                     â”‚
â”‚     Scale ML separately without affecting main app              â”‚
â”‚                                                                  â”‚
â”‚  3. TEAM SPECIALIZATION                                         â”‚
â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                        â”‚
â”‚     Data scientists work in Python                              â”‚
â”‚     Backend devs work in PHP/Laravel                            â”‚
â”‚     No overlap needed                                           â”‚
â”‚                                                                  â”‚
â”‚  4. MODEL FLEXIBILITY                                           â”‚
â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                           â”‚
â”‚     Update/retrain models without touching Laravel              â”‚
â”‚     Swap models with zero downtime                              â”‚
â”‚                                                                  â”‚
â”‚  5. RESOURCE ISOLATION                                          â”‚
â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                          â”‚
â”‚     Heavy ML computations won't block API requests              â”‚
â”‚     Each service has dedicated resources                        â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

# 4. System Architecture

## 4.1 High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              CLIENT LAYER                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚    â”‚   React Web  â”‚    â”‚  Mobile App  â”‚    â”‚  Admin Panel â”‚                â”‚
â”‚    â”‚   Frontend   â”‚    â”‚   (Future)   â”‚    â”‚              â”‚                â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚           â”‚                   â”‚                   â”‚                         â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                               â”‚                                              â”‚
â”‚                               â–¼                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                           API GATEWAY LAYER                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚    â”‚                      LARAVEL BACKEND                             â”‚     â”‚
â”‚    â”‚                                                                   â”‚     â”‚
â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚     â”‚
â”‚    â”‚  â”‚    User     â”‚  â”‚   Product   â”‚  â”‚    Order    â”‚              â”‚     â”‚
â”‚    â”‚  â”‚    Auth     â”‚  â”‚  Management â”‚  â”‚  Processing â”‚              â”‚     â”‚
â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚     â”‚
â”‚    â”‚                                                                   â”‚     â”‚
â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚     â”‚
â”‚    â”‚  â”‚   Review    â”‚  â”‚   Request   â”‚  â”‚  Response   â”‚              â”‚     â”‚
â”‚    â”‚  â”‚  Handling   â”‚  â”‚   Routing   â”‚  â”‚ Aggregation â”‚              â”‚     â”‚
â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚     â”‚
â”‚    â”‚                                                                   â”‚     â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                  â”‚                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                          SERVICE LAYER                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                  â”‚                                          â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚              â”‚                   â”‚                   â”‚                      â”‚
â”‚              â–¼                   â–¼                   â–¼                      â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚    â”‚   PostgreSQL    â”‚  â”‚   ML SERVICE    â”‚  â”‚     Redis       â”‚          â”‚
â”‚    â”‚                 â”‚  â”‚   (FastAPI)     â”‚  â”‚     Cache       â”‚          â”‚
â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚                 â”‚  â”‚                 â”‚          â”‚
â”‚    â”‚  â”‚  Users    â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚          â”‚
â”‚    â”‚  â”‚  Products â”‚  â”‚  â”‚  â”‚ Sentiment â”‚  â”‚  â”‚  â”‚ Sessions  â”‚  â”‚          â”‚
â”‚    â”‚  â”‚  Orders   â”‚  â”‚  â”‚  â”‚Personalityâ”‚  â”‚  â”‚  â”‚ Cached    â”‚  â”‚          â”‚
â”‚    â”‚  â”‚  Reviews  â”‚  â”‚  â”‚  â”‚  Recomm.  â”‚  â”‚  â”‚  â”‚ Data      â”‚  â”‚          â”‚
â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚          â”‚
â”‚    â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚          â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                  â”‚                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                          ML DATA LAYER                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                  â”‚                                          â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚              â”‚                   â”‚                   â”‚                      â”‚
â”‚              â–¼                   â–¼                   â–¼                      â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚    â”‚    MongoDB      â”‚  â”‚    Weaviate     â”‚  â”‚   Cassandra     â”‚          â”‚
â”‚    â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚          â”‚
â”‚    â”‚  â€¢ User         â”‚  â”‚  â€¢ Product      â”‚  â”‚  â€¢ Click        â”‚          â”‚
â”‚    â”‚    Profiles     â”‚  â”‚    Vectors      â”‚  â”‚    Streams      â”‚          â”‚
â”‚    â”‚  â€¢ ML Features  â”‚  â”‚  â€¢ User         â”‚  â”‚  â€¢ View Events  â”‚          â”‚
â”‚    â”‚  â€¢ Sentiment    â”‚  â”‚    Embeddings   â”‚  â”‚  â€¢ Interaction  â”‚          â”‚
â”‚    â”‚    History      â”‚  â”‚  â€¢ Similarity   â”‚  â”‚    Logs         â”‚          â”‚
â”‚    â”‚                 â”‚  â”‚    Index        â”‚  â”‚                 â”‚          â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 4.2 ML Service Internal Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ML SERVICE (FastAPI)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                         API LAYER (Routers)                          â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                 â”‚                 â”‚                 â”‚               â”‚   â”‚
â”‚  â”‚   /sentiment    â”‚  /personality   â”‚ /recommendationsâ”‚    /health    â”‚   â”‚
â”‚  â”‚                 â”‚                 â”‚                 â”‚               â”‚   â”‚
â”‚  â”‚  POST /analyze  â”‚  GET /profile   â”‚  GET /products  â”‚  GET /        â”‚   â”‚
â”‚  â”‚  GET /history   â”‚  POST /update   â”‚  GET /similar   â”‚  GET /ready   â”‚   â”‚
â”‚  â”‚  POST /batch    â”‚  GET /traits    â”‚  POST /feedback â”‚  GET /metrics â”‚   â”‚
â”‚  â”‚                 â”‚                 â”‚                 â”‚               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â”‚                 â”‚                 â”‚                             â”‚
â”‚           â–¼                 â–¼                 â–¼                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                       SERVICE LAYER                                  â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                 â”‚                 â”‚                                 â”‚   â”‚
â”‚  â”‚   Sentiment     â”‚   Personality   â”‚      Recommendation             â”‚   â”‚
â”‚  â”‚   Analyzer      â”‚   Classifier    â”‚         Engine                  â”‚   â”‚
â”‚  â”‚                 â”‚                 â”‚                                 â”‚   â”‚
â”‚  â”‚ â€¢ Text Preproc  â”‚ â€¢ Feature Eng   â”‚ â€¢ Collaborative Filter         â”‚   â”‚
â”‚  â”‚ â€¢ Model Infer   â”‚ â€¢ Clustering    â”‚ â€¢ Content-Based Filter         â”‚   â”‚
â”‚  â”‚ â€¢ Score Calc    â”‚ â€¢ Classificationâ”‚ â€¢ Hybrid Ranking               â”‚   â”‚
â”‚  â”‚                 â”‚                 â”‚                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â”‚                 â”‚                 â”‚                             â”‚
â”‚           â–¼                 â–¼                 â–¼                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                        MODEL LAYER                                   â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                 â”‚                 â”‚                                 â”‚   â”‚
â”‚  â”‚   BERT/DistilBERTâ”‚   K-Means      â”‚      Matrix                     â”‚   â”‚
â”‚  â”‚   Sentiment     â”‚   Clustering    â”‚      Factorization              â”‚   â”‚
â”‚  â”‚   Model         â”‚   Model         â”‚      (ALS)                      â”‚   â”‚
â”‚  â”‚                 â”‚                 â”‚                                 â”‚   â”‚
â”‚  â”‚ â€¢ HuggingFace   â”‚ â€¢ scikit-learn  â”‚ â€¢ implicit library             â”‚   â”‚
â”‚  â”‚ â€¢ Fine-tuned    â”‚ â€¢ Rule-based    â”‚ â€¢ Surprise library             â”‚   â”‚
â”‚  â”‚                 â”‚                 â”‚                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â”‚                 â”‚                 â”‚                             â”‚
â”‚           â–¼                 â–¼                 â–¼                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      DATABASE LAYER                                  â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                 â”‚                 â”‚                 â”‚               â”‚   â”‚
â”‚  â”‚    MongoDB      â”‚    Weaviate     â”‚   Cassandra     â”‚  PostgreSQL   â”‚   â”‚
â”‚  â”‚   Connector     â”‚   Connector     â”‚   Connector     â”‚  Connector    â”‚   â”‚
â”‚  â”‚   (motor)       â”‚   (weaviate-    â”‚   (cassandra-   â”‚  (asyncpg)    â”‚   â”‚
â”‚  â”‚                 â”‚    client)      â”‚    driver)      â”‚  (Read-Only)  â”‚   â”‚
â”‚  â”‚                 â”‚                 â”‚                 â”‚               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 4.3 Request Flow: User Submits Review

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     REQUEST FLOW: REVIEW SUBMISSION                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚     USER                                                                     â”‚
â”‚       â”‚                                                                      â”‚
â”‚       â”‚ 1. Submit Review                                                    â”‚
â”‚       â”‚    "This product is amazing! Love the quality"                      â”‚
â”‚       â–¼                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚  â”‚  React Frontend â”‚                                                        â”‚
â”‚  â”‚  POST /reviews  â”‚                                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚           â”‚                                                                  â”‚
â”‚           â”‚ 2. API Request                                                  â”‚
â”‚           â–¼                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚  Laravel API    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  PostgreSQL     â”‚                           â”‚
â”‚  â”‚  ReviewControllerâ”‚  3.     â”‚  Save Review    â”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  Store   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚           â”‚                                                                  â”‚
â”‚           â”‚ 4. Call ML Service                                              â”‚
â”‚           â”‚    POST /api/v1/sentiment/analyze                               â”‚
â”‚           â–¼                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚  â”‚  ML SERVICE     â”‚                                                        â”‚
â”‚  â”‚  /sentiment     â”‚                                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚           â”‚                                                                  â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”                                                           â”‚
â”‚     â”‚           â”‚                                                           â”‚
â”‚     â–¼           â–¼                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                                                     â”‚
â”‚  â”‚ BERT   â”‚  â”‚MongoDB â”‚                                                     â”‚
â”‚  â”‚ Model  â”‚  â”‚ Store  â”‚                                                     â”‚
â”‚  â”‚Analyze â”‚  â”‚Result  â”‚                                                     â”‚
â”‚  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                     â”‚
â”‚      â”‚                                                                       â”‚
â”‚      â”‚ 5. Return: {score: 0.92, label: "positive"}                         â”‚
â”‚      â–¼                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚  â”‚ Update User     â”‚                                                        â”‚
â”‚  â”‚ Profile         â”‚                                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚           â”‚                                                                  â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”                                                           â”‚
â”‚     â”‚           â”‚                                                           â”‚
â”‚     â–¼           â–¼                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                                                     â”‚
â”‚  â”‚Recalc  â”‚  â”‚Update  â”‚                                                     â”‚
â”‚  â”‚Person- â”‚  â”‚Vector  â”‚                                                     â”‚
â”‚  â”‚ality   â”‚  â”‚Weaviateâ”‚                                                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                     â”‚
â”‚      â”‚                                                                       â”‚
â”‚      â”‚ 6. Response to Laravel                                               â”‚
â”‚      â–¼                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚  â”‚  Laravel        â”‚                                                        â”‚
â”‚  â”‚  Update Review  â”‚                                                        â”‚
â”‚  â”‚  sentiment_scoreâ”‚                                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚           â”‚                                                                  â”‚
â”‚           â”‚ 7. Response to User                                             â”‚
â”‚           â–¼                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚  â”‚  "Review saved  â”‚                                                        â”‚
â”‚  â”‚   successfully!"â”‚                                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 4.4 Request Flow: Get Recommendations

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  REQUEST FLOW: GET RECOMMENDATIONS                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚     USER visits Homepage                                                    â”‚
â”‚       â”‚                                                                      â”‚
â”‚       â–¼                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚  â”‚  React Frontend â”‚                                                        â”‚
â”‚  â”‚GET /recommend   â”‚                                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚           â”‚                                                                  â”‚
â”‚           â–¼                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚  Laravel API    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  Redis Cache    â”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  Check  â”‚  (Cache Miss)   â”‚                           â”‚
â”‚           â”‚           Cache  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚           â”‚                                                                  â”‚
â”‚           â”‚ GET /api/v1/recommendations/{user_id}                          â”‚
â”‚           â–¼                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚                      ML SERVICE                              â”‚           â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”‚
â”‚  â”‚                                                              â”‚           â”‚
â”‚  â”‚  1. Load User Context                                       â”‚           â”‚
â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚           â”‚
â”‚  â”‚     â”‚ MongoDB  â”‚  â”‚PostgreSQLâ”‚  â”‚Cassandra â”‚               â”‚           â”‚
â”‚  â”‚     â”‚ Profile  â”‚  â”‚ Purchasesâ”‚  â”‚ Clicks   â”‚               â”‚           â”‚
â”‚  â”‚     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜               â”‚           â”‚
â”‚  â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚           â”‚
â”‚  â”‚                         â–¼                                    â”‚           â”‚
â”‚  â”‚  2. Generate Recommendations                                â”‚           â”‚
â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚           â”‚
â”‚  â”‚     â”‚Collaborativeâ”‚ â”‚Content-   â”‚ â”‚Personality â”‚           â”‚           â”‚
â”‚  â”‚     â”‚Filter (40%)â”‚ â”‚Based (30%)â”‚ â”‚Match (30%) â”‚           â”‚           â”‚
â”‚  â”‚     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜           â”‚           â”‚
â”‚  â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚           â”‚
â”‚  â”‚                          â–¼                                   â”‚           â”‚
â”‚  â”‚  3. Hybrid Fusion + Business Rules + Diversity             â”‚           â”‚
â”‚  â”‚                          â”‚                                   â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                             â”‚                                               â”‚
â”‚                             â”‚ Return Ranked Products                       â”‚
â”‚                             â–¼                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚  â”‚  Laravel        â”‚â”€â”€â”€â”€â”€â”€â–¶ Cache in Redis                                 â”‚
â”‚  â”‚  Enrich with    â”‚                                                        â”‚
â”‚  â”‚  Product Detailsâ”‚                                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚           â”‚                                                                  â”‚
â”‚           â–¼                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚  "Recommended for you:"                      â”‚                           â”‚
â”‚  â”‚  [Product A] [Product B] [Product C]        â”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

# 5. Core Components

## 5.1 Component Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ML SERVICE COMPONENTS                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚   SENTIMENT  â”‚  â”‚ PERSONALITY  â”‚  â”‚RECOMMENDATIONâ”‚          â”‚
â”‚  â”‚   ANALYZER   â”‚  â”‚ CLASSIFIER   â”‚  â”‚    ENGINE    â”‚          â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚          â”‚
â”‚  â”‚  Understands â”‚  â”‚   Profiles   â”‚  â”‚   Suggests   â”‚          â”‚
â”‚  â”‚  how users   â”‚  â”‚    user      â”‚  â”‚   relevant   â”‚          â”‚
â”‚  â”‚    feel      â”‚  â”‚  behavior    â”‚  â”‚   products   â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚         â”‚                 â”‚                 â”‚                   â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                           â”‚                                      â”‚
â”‚                           â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    PROFILE MANAGER                        â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  Orchestrates data flow between components and databases  â”‚  â”‚
â”‚  â”‚  â€¢ Creates new user profiles                              â”‚  â”‚
â”‚  â”‚  â€¢ Updates existing profiles                              â”‚  â”‚
â”‚  â”‚  â€¢ Manages profile versioning                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                           â”‚                                      â”‚
â”‚                           â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    VECTOR SERVICE                         â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  Handles embeddings and similarity computations           â”‚  â”‚
â”‚  â”‚  â€¢ Product embedding generation                           â”‚  â”‚
â”‚  â”‚  â€¢ User preference vectors                                â”‚  â”‚
â”‚  â”‚  â€¢ Similarity search via Weaviate                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

```

### 5.2 Component Details

#### 5.2.1 Sentiment Analyzer

**Purpose:** Determines the emotional tone and opinion expressed in customer reviews.

**Capabilities:**
- Binary classification (positive/negative)
- Multi-class classification (positive/neutral/negative)
- Fine-grained scoring (-1.0 to 1.0)
- Aspect-based sentiment (sentiment toward specific product features)
- Multilingual support (English and Arabic)

#### 5.2.2 Personality Classifier

**Purpose:** Categorizes users into personality types based on their behavioral patterns.

**Capabilities:**
- Behavioral clustering based on purchase patterns
- Trait extraction from review sentiments
- Dynamic profile updates with new data
- Segment assignment for marketing purposes

#### 5.2.3 Recommendation Engine

**Purpose:** Generates personalized product suggestions for each user.

**Capabilities:**
- Collaborative filtering (user-user and item-item)
- Content-based filtering (product attributes)
- Hybrid recommendations (combining multiple approaches)
- Context-aware suggestions (time, season, device)
- Diversity and novelty balancing

---

## 6. Data Flow

### 6.1 Complete Data Flow

```

                    USER ACTIONS
                         â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚               â”‚               â”‚
         â–¼               â–¼               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Browse  â”‚    â”‚Purchase â”‚    â”‚ Review  â”‚
    â”‚Products â”‚    â”‚ Product â”‚    â”‚ Product â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚               â”‚               â”‚
         â–¼               â–¼               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚Cassandraâ”‚    â”‚PostgreSQLâ”‚   â”‚PostgreSQLâ”‚
    â”‚  Log    â”‚    â”‚  Store   â”‚   â”‚  Store   â”‚
    â”‚Interact â”‚    â”‚ Purchase â”‚   â”‚  Review  â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚               â”‚               â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚    ML SERVICE       â”‚
              â”‚                     â”‚
              â”‚  Aggregate â†’ Analyzeâ”‚
              â”‚  â†’ Classify â†’       â”‚
              â”‚  Generate Embeddingsâ”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚               â”‚               â”‚
         â–¼               â–¼               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ MongoDB â”‚    â”‚Weaviate â”‚    â”‚  Redis  â”‚
    â”‚ Profile â”‚    â”‚ Vectors â”‚    â”‚  Cache  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```

---

## 7. Sentiment Analysis Module

### 7.1 Overview

The Sentiment Analysis Module uses state-of-the-art NLP to classify text as positive, negative, or neutral.

### 7.2 Processing Pipeline

```

Input: "This product is amazing!"
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TEXT PREPROCESSOR â”‚
â”‚ â€¢ Lowercase conversion â”‚
â”‚ â€¢ Remove special characters â”‚
â”‚ â€¢ Handle contractions â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TOKENIZER (WordPiece) â”‚
â”‚ ['[CLS]', 'this', 'product', â”‚
â”‚ 'is', 'amazing', '[SEP]'] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MODEL INFERENCE â”‚
â”‚ DistilBERT / BERT â”‚
â”‚ Forward pass â†’ Classification â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â–¼
Output: {score: 0.92, label: "positive", confidence: 0.96}

````

### 7.3 Supported Models

| Model | Language | Size | Accuracy |
|-------|----------|------|----------|
| distilbert-base-uncased-finetuned-sst-2-english | English | 268MB | 91% |
| CAMeL-Lab/bert-base-arabic-camelbert-mix | Arabic | 440MB | 89% |

### 7.4 Output Schema

```json
{
    "request_id": "uuid-string",
    "user_id": 123,
    "product_id": 456,
    "original_text": "Great product!",
    "sentiment": {
        "score": 0.87,
        "label": "positive",
        "confidence": 0.94
    },
    "processed_at": "2025-01-19T10:30:00Z"
}
````

---

## 8. Personality Classification Module

### 8.1 Personality Dimensions

We classify users across five key dimensions:

| Dimension            | Low End                | High End                   |
| -------------------- | ---------------------- | -------------------------- |
| Price Sensitivity    | Premium Seeker         | Budget Conscious           |
| Exploration Tendency | Loyal (Few Categories) | Explorer (Many Categories) |
| Sentiment Tendency   | Critical Reviewer      | Enthusiastic Reviewer      |
| Purchase Frequency   | Occasional Shopper     | Frequent Buyer             |
| Decision Speed       | Deliberate Researcher  | Impulsive Buyer            |

### 8.2 Personality Types

Based on dimension combinations:

| Type                      | Description                                                 |
| ------------------------- | ----------------------------------------------------------- |
| **Adventurous Premium**   | High exploration, low price sensitivity, positive sentiment |
| **Cautious Value Seeker** | Low exploration, high price sensitivity, critical           |
| **Loyal Enthusiast**      | Low exploration, positive sentiment, frequent buyer         |
| **Bargain Hunter**        | High exploration, high price sensitivity                    |
| **Quality Focused**       | Low sensitivity, critical reviewer, deliberate              |
| **Trend Follower**        | High exploration, positive, fast decisions                  |
| **Practical Shopper**     | Medium on all dimensions                                    |
| **Impulse Buyer**         | High exploration, fast decisions, frequent                  |

### 8.3 Feature Calculations

| Feature            | Formula                                | Data Source |
| ------------------ | -------------------------------------- | ----------- |
| avg_purchase_price | SUM(order_total) / COUNT(orders)       | PostgreSQL  |
| purchase_frequency | COUNT(orders) / months_active          | PostgreSQL  |
| category_diversity | COUNT(DISTINCT categories) / total     | PostgreSQL  |
| avg_sentiment      | SUM(sentiment_scores) / COUNT(reviews) | MongoDB     |
| time_to_purchase   | AVG(purchase_time - first_view_time)   | PostgreSQL  |

### 8.4 Profile Schema (MongoDB)

```json
{
  "_id": "ObjectId",
  "user_id": 123,
  "personality_type": "adventurous_premium",
  "confidence": 0.87,
  "dimensions": {
    "price_sensitivity": { "score": 0.2, "label": "low" },
    "exploration_tendency": { "score": 0.9, "label": "high" },
    "sentiment_tendency": { "score": 0.8, "label": "enthusiastic" },
    "purchase_frequency": { "score": 0.85, "label": "frequent" },
    "decision_speed": { "score": 0.75, "label": "fast" }
  },
  "traits": {
    "preferred_categories": ["electronics", "outdoor"],
    "preferred_price_range": { "min": 50, "max": 200 }
  },
  "updated_at": "2025-01-19T10:30:00Z"
}
```

---

## 9. Recommendation Engine

### 9.1 Recommendation Approaches

**Collaborative Filtering**

- "Users who bought X also bought Y"
- Algorithm: Matrix Factorization (ALS)
- Library: implicit / surprise

**Content-Based Filtering**

- "Based on product attributes you've liked"
- Uses product features: category, price, brand, description
- Algorithm: Cosine Similarity

**Personality-Based Filtering**

- "Products that match your shopping personality"
- Adventurous Premium â†’ New arrivals, premium brands
- Bargain Hunter â†’ Flash sales, clearance

### 9.2 Hybrid Pipeline

```
User Request
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         LOAD USER CONTEXT           â”‚
â”‚  â€¢ Profile from MongoDB             â”‚
â”‚  â€¢ History from PostgreSQL           â”‚
â”‚  â€¢ Purchases from PostgreSQL        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚              â”‚              â”‚
    â–¼              â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Collab  â”‚   â”‚Content â”‚   â”‚Person- â”‚
â”‚Filter  â”‚   â”‚Based   â”‚   â”‚ality   â”‚
â”‚Weight  â”‚   â”‚Weight  â”‚   â”‚Weight  â”‚
â”‚ 0.4    â”‚   â”‚ 0.3    â”‚   â”‚ 0.3    â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
    â”‚            â”‚            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         SCORE FUSION                â”‚
â”‚  final = 0.4*cf + 0.3*cb + 0.3*pb  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     BUSINESS RULES & DIVERSITY      â”‚
â”‚  â€¢ Remove out of stock              â”‚
â”‚  â€¢ Max 3 per category               â”‚
â”‚  â€¢ Include discovery items          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
          Final Recommendations
```

### 9.3 Cold Start Handling

**New User (No history):**

1. Popularity-based (trending, best sellers)
2. Demographic-based (if data available)
3. Onboarding quiz (3-5 preference questions)
4. Browsing-based (real-time session tracking)

**New Product (No purchases):**

1. Content-based (find similar existing products)
2. Category association
3. Boost to "Explorer" personalities

### 9.4 Response Schema

```json
{
  "user_id": 123,
  "recommendations": [
    {
      "rank": 1,
      "product_id": 42,
      "score": 0.94,
      "explanation": "Based on your interest in premium audio",
      "scores_breakdown": {
        "collaborative": 0.92,
        "content_based": 0.95,
        "personality": 0.96
      }
    }
  ],
  "metadata": {
    "generated_at": "2025-01-19T10:30:00Z",
    "processing_time_ms": 45
  }
}
```

---

## 10. Database Connections

### 10.1 Database Overview

| Database       | Purpose                                 | Access     |
| -------------- | --------------------------------------- | ---------- |
| **PostgreSQL** | Business data (users, products, orders) | Read-only  |
| **MongoDB**    | User profiles, ML features              | Read/Write |
| **Weaviate**   | Vector embeddings, similarity search    | Read/Write |
| **PostgreSQL** | User interaction events (via interaction_client) | Read/Write |
| **Redis**      | Caching, rate limiting                  | Read/Write |

### 10.2 Connection Configuration

```python
# PostgreSQL
POSTGRES_CONFIG = {
    "host": "localhost",
    "port": 5432,
    "database": "ecommerce_db",
    "user": "ml_service_readonly",
    "min_connections": 5,
    "max_connections": 10
}

# MongoDB
MONGO_CONFIG = {
    "uri": "mongodb://localhost:27017",
    "database": "ml_profiles",
    "min_pool_size": 10,
    "max_pool_size": 20
}

# Weaviate
WEAVIATE_CONFIG = {
    "url": "http://localhost:8080",
    "timeout_config": (5, 30)
}

# Interaction logging uses PostgreSQL (no separate config needed)

# Redis
REDIS_CONFIG = {
    "url": "redis://localhost:6379/0",
    "max_connections": 50
}
```

---

## 11. API Specifications

### 11.1 Base Configuration

```
Base URL: http://localhost:8000/api/v1
Authentication: X-Service-Auth header
```

### 11.2 Endpoints

#### Health & Status

| Method | Endpoint        | Description                        |
| ------ | --------------- | ---------------------------------- |
| GET    | `/health`       | Basic health check                 |
| GET    | `/health/ready` | Readiness check (all dependencies) |
| GET    | `/metrics`      | Prometheus metrics                 |

#### Sentiment Analysis

| Method | Endpoint                       | Description              |
| ------ | ------------------------------ | ------------------------ |
| POST   | `/sentiment/analyze`           | Analyze single text      |
| POST   | `/sentiment/batch`             | Analyze multiple texts   |
| GET    | `/sentiment/history/{user_id}` | User's sentiment history |

#### Personality

| Method | Endpoint                         | Description            |
| ------ | -------------------------------- | ---------------------- |
| GET    | `/personality/profile/{user_id}` | Get user profile       |
| POST   | `/personality/update`            | Trigger profile update |
| GET    | `/personality/traits/{user_id}`  | Get detailed traits    |

#### Recommendations

| Method | Endpoint                                | Description                      |
| ------ | --------------------------------------- | -------------------------------- |
| GET    | `/recommendations/{user_id}`            | Get personalized recommendations |
| GET    | `/recommendations/similar/{product_id}` | Get similar products             |
| POST   | `/recommendations/feedback`             | Submit feedback                  |

### 11.3 Example Requests

**Sentiment Analysis:**

```http
POST /api/v1/sentiment/analyze
Content-Type: application/json
X-Service-Auth: {token}

{
    "text": "This product exceeded my expectations!",
    "user_id": 123,
    "product_id": 456,
    "store_result": true
}
```

**Response:**

```json
{
  "success": true,
  "data": {
    "sentiment": {
      "score": 0.91,
      "label": "positive",
      "confidence": 0.96
    }
  }
}
```

### 11.4 Error Codes

| Code             | HTTP Status | Description        |
| ---------------- | ----------- | ------------------ |
| VALIDATION_ERROR | 400         | Invalid parameters |
| UNAUTHORIZED     | 401         | Invalid auth token |
| NOT_FOUND        | 404         | Resource not found |
| RATE_LIMITED     | 429         | Too many requests  |
| INTERNAL_ERROR   | 500         | Server error       |

---

## 12. Required Libraries and Dependencies

### 12.1 Core Dependencies

```txt
# requirements.txt

# WEB FRAMEWORK
fastapi==0.109.0
uvicorn[standard]==0.27.0
pydantic==2.5.3

# MACHINE LEARNING - CORE
numpy==1.26.3
pandas==2.1.4
scikit-learn==1.4.0
scipy==1.12.0

# DEEP LEARNING
torch==2.1.2
transformers==4.36.2
sentence-transformers==2.2.2

# NLP
nltk==3.8.1
langdetect==1.0.9

# RECOMMENDATION SYSTEMS
implicit==0.7.2
surprise==1.1.3

# DATABASE DRIVERS
asyncpg==0.29.0          # PostgreSQL
motor==3.3.2             # MongoDB
# cassandra-driver removed - interaction logging now uses PostgreSQL
weaviate-client==4.4.1   # Weaviate
redis==5.0.1             # Redis

# UTILITIES
python-dotenv==1.0.0
httpx==0.26.0
structlog==24.1.0

# MONITORING
prometheus-client==0.19.0

# TESTING
pytest==7.4.4
pytest-asyncio==0.23.3
```

### 12.2 System Requirements

| Component | Minimum | Recommended |
| --------- | ------- | ----------- |
| Python    | 3.10    | 3.11+       |
| RAM       | 4GB     | 8GB+        |
| CPU       | 2 cores | 4+ cores    |
| Disk      | 10GB    | 50GB        |

### 12.3 Model Downloads

```bash
# Sentiment model
python -c "from transformers import pipeline; pipeline('sentiment-analysis')"

# Sentence transformer
python -c "from sentence_transformers import SentenceTransformer; SentenceTransformer('all-MiniLM-L6-v2')"

# Arabic model (optional)
python -c "from transformers import pipeline; pipeline('sentiment-analysis', model='CAMeL-Lab/bert-base-arabic-camelbert-mix-sentiment')"
```

---

## 13. Environment Configuration

### 13.1 Environment Variables

```bash
# .env

# APPLICATION
APP_NAME=ml-service
APP_ENV=development
APP_DEBUG=true
APP_PORT=8000
LOG_LEVEL=INFO

# POSTGRESQL (Read-Only)
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=ecommerce_db
POSTGRES_USER=ml_service_readonly
POSTGRES_PASSWORD=your_password

# MONGODB
MONGO_URI=mongodb://localhost:27017
MONGO_DB=ml_profiles

# WEAVIATE
WEAVIATE_URL=http://localhost:8080

# REDIS
REDIS_URL=redis://localhost:6379/0

# AUTHENTICATION
SERVICE_AUTH_TOKEN=your_service_token

# ML MODELS
SENTIMENT_MODEL=distilbert-base-uncased-finetuned-sst-2-english
EMBEDDING_MODEL=all-MiniLM-L6-v2

# CACHING
PROFILE_CACHE_TTL=3600
RECOMMENDATION_CACHE_TTL=300
```

---

## 14. Project Structure

```
ml-service/
â”‚
â”œâ”€â”€ main.py                    # FastAPI entry point
â”œâ”€â”€ requirements.txt           # Dependencies
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ .env.example
â”‚
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ settings.py            # Pydantic settings
â”‚   â””â”€â”€ logging.py
â”‚
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ dependencies.py
â”‚   â”œâ”€â”€ middleware.py
â”‚   â””â”€â”€ v1/
â”‚       â”œâ”€â”€ router.py
â”‚       â”œâ”€â”€ endpoints/
â”‚       â”‚   â”œâ”€â”€ health.py
â”‚       â”‚   â”œâ”€â”€ sentiment.py
â”‚       â”‚   â”œâ”€â”€ personality.py
â”‚       â”‚   â””â”€â”€ recommendations.py
â”‚       â””â”€â”€ schemas/
â”‚           â”œâ”€â”€ sentiment.py
â”‚           â”œâ”€â”€ personality.py
â”‚           â””â”€â”€ recommendations.py
â”‚
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ sentiment/
â”‚   â”‚   â”œâ”€â”€ analyzer.py
â”‚   â”‚   â”œâ”€â”€ preprocessor.py
â”‚   â”‚   â””â”€â”€ models.py
â”‚   â”œâ”€â”€ personality/
â”‚   â”‚   â”œâ”€â”€ classifier.py
â”‚   â”‚   â”œâ”€â”€ features.py
â”‚   â”‚   â””â”€â”€ clustering.py
â”‚   â”œâ”€â”€ recommendations/
â”‚   â”‚   â”œâ”€â”€ engine.py
â”‚   â”‚   â”œâ”€â”€ collaborative.py
â”‚   â”‚   â”œâ”€â”€ content_based.py
â”‚   â”‚   â””â”€â”€ hybrid.py
â”‚   â””â”€â”€ vectors/
â”‚       â”œâ”€â”€ embeddings.py
â”‚       â””â”€â”€ similarity.py
â”‚
â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ postgres/
â”‚   â”‚   â”œâ”€â”€ connection.py
â”‚   â”‚   â””â”€â”€ repositories/
â”‚   â”œâ”€â”€ mongodb/
â”‚   â”‚   â”œâ”€â”€ connection.py
â”‚   â”‚   â””â”€â”€ collections/
â”‚   â”œâ”€â”€ weaviate/
â”‚   â”‚   â”œâ”€â”€ client.py
â”‚   â”‚   â””â”€â”€ operations.py
â”‚   â”œâ”€â”€ cassandra/
â”‚   â”‚   â””â”€â”€ connection.py
â”‚   â””â”€â”€ redis/
â”‚       â””â”€â”€ client.py
â”‚
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ sentiment_service.py
â”‚   â”œâ”€â”€ personality_service.py
â”‚   â””â”€â”€ recommendation_service.py
â”‚
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ model_loader.py
â”‚   â””â”€â”€ pretrained/
â”‚
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ text.py
â”‚   â””â”€â”€ validators.py
â”‚
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ unit/
â”‚   â”œâ”€â”€ integration/
â”‚   â””â”€â”€ fixtures/
â”‚
â””â”€â”€ scripts/
    â”œâ”€â”€ init_databases.py
    â””â”€â”€ seed_data.py
```

---

## 15. Integration with Laravel

### 15.1 Laravel Service Class

```php
<?php
// app/Services/MLService.php

namespace App\Services;

use Illuminate\Support\Facades\Http;
use Illuminate\Support\Facades\Cache;

class MLService
{
    private string $baseUrl;
    private string $authToken;

    public function __construct()
    {
        $this->baseUrl = config('services.ml.url');
        $this->authToken = config('services.ml.token');
    }

    public function analyzeSentiment(string $text, int $userId, int $productId): array
    {
        return $this->post('/api/v1/sentiment/analyze', [
            'text' => $text,
            'user_id' => $userId,
            'product_id' => $productId,
        ]);
    }

    public function getUserProfile(int $userId): array
    {
        return Cache::remember("ml_profile_{$userId}", 3600, function () use ($userId) {
            return $this->get("/api/v1/personality/profile/{$userId}");
        });
    }

    public function getRecommendations(int $userId, int $limit = 10): array
    {
        return Cache::remember("ml_recs_{$userId}", 300, function () use ($userId, $limit) {
            return $this->get("/api/v1/recommendations/{$userId}?limit={$limit}");
        });
    }

    public function getSimilarProducts(int $productId, int $limit = 5): array
    {
        return $this->get("/api/v1/recommendations/similar/{$productId}?limit={$limit}");
    }

    private function get(string $endpoint): array
    {
        $response = Http::withHeaders([
            'X-Service-Auth' => $this->authToken,
        ])->get($this->baseUrl . $endpoint);

        return $response->json()['data'] ?? [];
    }

    private function post(string $endpoint, array $data): array
    {
        $response = Http::withHeaders([
            'X-Service-Auth' => $this->authToken,
        ])->post($this->baseUrl . $endpoint, $data);

        return $response->json()['data'] ?? [];
    }
}
```

### 15.2 Usage in Controllers

```php
<?php
// app/Http/Controllers/ReviewController.php

class ReviewController extends Controller
{
    public function store(Request $request, MLService $mlService)
    {
        $review = Review::create($request->validated());

        // Analyze sentiment
        $sentiment = $mlService->analyzeSentiment(
            $review->comment,
            $review->user_id,
            $review->product_id
        );

        $review->update([
            'sentiment_score' => $sentiment['sentiment']['score'],
            'sentiment_label' => $sentiment['sentiment']['label'],
        ]);

        return response()->json($review);
    }
}
```

### 15.3 Laravel Configuration

```php
// config/services.php

return [
    'ml' => [
        'url' => env('ML_SERVICE_URL', 'http://localhost:8000'),
        'token' => env('ML_SERVICE_TOKEN'),
    ],
];
```

---

## 16. Machine Learning Models

### 16.1 Sentiment Model Implementation

```python
# core/sentiment/models.py

from transformers import AutoTokenizer, AutoModelForSequenceClassification
import torch

class SentimentModel:
    def __init__(self, model_name: str):
        self.tokenizer = AutoTokenizer.from_pretrained(model_name)
        self.model = AutoModelForSequenceClassification.from_pretrained(model_name)
        self.model.eval()

    @torch.no_grad()
    def predict(self, text: str) -> dict:
        inputs = self.tokenizer(text, return_tensors="pt", truncation=True, max_length=512)
        outputs = self.model(**inputs)
        probs = torch.nn.functional.softmax(outputs.logits, dim=-1)[0]

        labels = ["negative", "positive"]
        predicted = probs.argmax().item()

        return {
            "label": labels[predicted],
            "score": float(probs[predicted]),
            "raw_scores": {l: float(p) for l, p in zip(labels, probs)}
        }
```

### 16.2 Embedding Model Implementation

```python
# core/vectors/embeddings.py

from sentence_transformers import SentenceTransformer
import numpy as np

class EmbeddingModel:
    def __init__(self, model_name: str = "all-MiniLM-L6-v2"):
        self.model = SentenceTransformer(model_name)

    def embed_text(self, text: str) -> np.ndarray:
        return self.model.encode(text, convert_to_numpy=True)

    def embed_product(self, product: dict) -> np.ndarray:
        text = f"{product['name']} {product['description']} {product['category']}"
        return self.embed_text(text)

    def similarity(self, vec1: np.ndarray, vec2: np.ndarray) -> float:
        return float(np.dot(vec1, vec2) / (np.linalg.norm(vec1) * np.linalg.norm(vec2)))
```

### 16.3 Collaborative Filtering

```python
# core/recommendations/collaborative.py

from implicit.als import AlternatingLeastSquares
from scipy.sparse import csr_matrix

class CollaborativeFilter:
    def __init__(self, factors: int = 64):
        self.model = AlternatingLeastSquares(factors=factors, iterations=20)
        self.user_mapping = {}
        self.item_mapping = {}

    def fit(self, interactions: list[tuple[int, int, float]]):
        # Build sparse matrix and train
        users = sorted(set(i[0] for i in interactions))
        items = sorted(set(i[1] for i in interactions))

        self.user_mapping = {u: i for i, u in enumerate(users)}
        self.item_mapping = {item: i for i, item in enumerate(items)}

        # Create matrix and fit
        # ... implementation

    def recommend(self, user_id: int, n: int = 10) -> list[tuple[int, float]]:
        # Return recommendations
        # ... implementation
```

---

## 17. Performance Considerations

### 17.1 Caching Strategy

| Cache Layer     | Data               | TTL                  |
| --------------- | ------------------ | -------------------- |
| In-Memory (LRU) | Model instances    | Application lifetime |
| Redis           | User profiles      | 1 hour               |
| Redis           | Recommendations    | 5 minutes            |
| Redis           | Similarity results | 24 hours             |

### 17.2 Response Time Targets

| Endpoint                     | Target | P95   |
| ---------------------------- | ------ | ----- |
| Health Check                 | <10ms  | 5ms   |
| Get Profile (cached)         | <50ms  | 35ms  |
| Sentiment Analysis           | <300ms | 200ms |
| Get Recommendations (cached) | <50ms  | 40ms  |
| Get Recommendations (miss)   | <500ms | 400ms |

### 17.3 Optimization Tips

1. **Batch Processing**: Use `predict_batch()` for multiple items
2. **Pre-computation**: Nightly jobs for embeddings and popular recommendations
3. **Async Operations**: Non-blocking database calls
4. **Model Loading**: Load once at startup, cache in memory

---

## 18. Security Considerations

### 18.1 Security Layers

1. **Network**: ML Service not exposed publicly, internal network only
2. **Authentication**: Service-to-service token validation
3. **Input Validation**: Pydantic schemas, text length limits
4. **Data Protection**: No PII stored, only user IDs
5. **Rate Limiting**: 100 requests/minute per service

### 18.2 Authentication Middleware

```python
# api/middleware.py

from fastapi import Request, HTTPException
import hmac

class AuthenticationMiddleware:
    EXCLUDED_PATHS = {"/health", "/health/ready", "/metrics"}

    async def __call__(self, request: Request, call_next):
        if request.url.path in self.EXCLUDED_PATHS:
            return await call_next(request)

        auth_header = request.headers.get("X-Service-Auth")
        expected = settings.service_auth_token

        if not auth_header or not hmac.compare_digest(auth_header, expected):
            raise HTTPException(status_code=401, detail="Unauthorized")

        return await call_next(request)
```

---

## 19. Testing Strategy

### 19.1 Test Categories

- **Unit Tests (70%)**: Model predictions, feature engineering, utilities
- **Integration Tests (25%)**: API endpoints, database operations
- **E2E Tests (5%)**: Full pipeline tests

### 19.2 Example Unit Tests

```python
# tests/unit/test_sentiment.py

import pytest
from core.sentiment.analyzer import SentimentAnalyzer

class TestSentimentAnalyzer:
    @pytest.fixture
    def analyzer(self):
        return SentimentAnalyzer()

    def test_positive_sentiment(self, analyzer):
        result = analyzer.analyze("This product is amazing!")
        assert result["label"] == "positive"
        assert result["score"] > 0.7

    def test_negative_sentiment(self, analyzer):
        result = analyzer.analyze("Terrible quality.")
        assert result["label"] == "negative"
```

### 19.3 Running Tests

```bash
pytest                          # All tests
pytest --cov=. --cov-report=html  # With coverage
pytest tests/unit/              # Unit only
pytest -k "sentiment"           # Pattern match
```

---

## 20. Deployment Guide

### 20.1 Docker Compose (Development)

```yaml
version: "3.8"

services:
  ml-service:
    build: .
    ports:
      - "8000:8000"
    environment:
      - POSTGRES_HOST=postgres
      - MONGO_URI=mongodb://mongo:27017
      - WEAVIATE_URL=http://weaviate:8080
      - REDIS_URL=redis://redis:6379/0
    depends_on:
      - postgres
      - mongo
      - weaviate
      - redis

  postgres:
    image: postgres:15
    environment:
      - POSTGRES_DB=ecommerce

  mongo:
    image: mongo:7

  weaviate:
    image: semitechnologies/weaviate:1.23.0

  redis:
    image: redis:7-alpine
```

### 20.2 Production Dockerfile

```dockerfile
FROM python:3.11-slim

WORKDIR /app

RUN apt-get update && apt-get install -y libpq5

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Download models
RUN python -c "from transformers import pipeline; pipeline('sentiment-analysis')"

COPY . .

EXPOSE 8000
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000", "--workers", "4"]
```

---

## 21. Future Enhancements

### 21.1 Roadmap

**Phase 2 (3-6 months):**

- Real-time recommendations (WebSocket)
- A/B testing framework
- Aspect-based sentiment analysis
- Explainable AI

**Phase 3 (6-12 months):**

- Multi-language support
- Image-based recommendations
- Reinforcement learning ranking

**Phase 4 (12+ months):**

- Conversational recommendations
- Cross-platform tracking
- AR/VR integration

---

## Appendix: Quick Reference

### API Endpoints

```
GET  /health                               â†’ Health check
POST /api/v1/sentiment/analyze             â†’ Analyze sentiment
GET  /api/v1/personality/profile/{user_id} â†’ Get profile
GET  /api/v1/recommendations/{user_id}     â†’ Get recommendations
GET  /api/v1/recommendations/similar/{id}  â†’ Similar products
```

### Key Technologies

| Component  | Technology                                      |
| ---------- | ----------------------------------------------- |
| Framework  | FastAPI                                         |
| ML         | PyTorch, Transformers, scikit-learn             |
| Databases  | PostgreSQL, MongoDB, Weaviate, Redis |
| Deployment | Docker, uvicorn                                 |

---

**Document Version:** 1.0  
**Last Updated:** January 2025  
**Status:** Ready for Implementation
outdoor"],
"preferred_price_range": {"min": 50, "max": 200}
},
"last_updated": "2025-01-19T10:30:00Z"
}
}

````

### Get Recommendations

**Request:**
```http
GET /api/v1/recommendations/123?limit=5&context=homepage
X-Service-Auth: {token}
````

**Response:**

```json
{
  "success": true,
  "data": {
    "user_id": 123,
    "recommendations": [
      {
        "rank": 1,
        "product_id": 42,
        "score": 0.94,
        "explanation": "Based on your interest in premium audio"
      },
      {
        "rank": 2,
        "product_id": 17,
        "score": 0.89,
        "explanation": "Popular with similar shoppers"
      }
    ],
    "metadata": {
      "generated_at": "2025-01-19T10:30:00Z",
      "processing_time_ms": 45
    }
  }
}
```

## 11.4 Error Responses

```json
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Invalid user_id format",
    "details": {
      "field": "user_id",
      "constraint": "must be a positive integer"
    }
  },
  "request_id": "550e8400-e29b-41d4-a716-446655440000"
}
```

| Error Code          | HTTP Status | Description                   |
| ------------------- | ----------- | ----------------------------- |
| VALIDATION_ERROR    | 400         | Invalid request parameters    |
| UNAUTHORIZED        | 401         | Invalid or missing auth token |
| NOT_FOUND           | 404         | Resource not found            |
| RATE_LIMITED        | 429         | Too many requests             |
| INTERNAL_ERROR      | 500         | Server error                  |
| SERVICE_UNAVAILABLE | 503         | Dependency unavailable        |

---

# 12. Required Libraries and Dependencies

## 12.1 Complete requirements.txt

```txt
# ============================================
# WEB FRAMEWORK
# ============================================
fastapi==0.109.0              # High-performance async API framework
uvicorn[standard]==0.27.0     # ASGI server
pydantic==2.5.3               # Data validation
python-multipart==0.0.6       # Form data parsing

# ============================================
# MACHINE LEARNING - CORE
# ============================================
numpy==1.26.3                 # Numerical computing
pandas==2.1.4                 # Data manipulation
scikit-learn==1.4.0           # ML algorithms
scipy==1.12.0                 # Scientific computing

# ============================================
# DEEP LEARNING
# ============================================
torch==2.1.2                  # PyTorch (CPU version)
# torch==2.1.2+cu121          # PyTorch with CUDA (for GPU)
transformers==4.36.2          # Hugging Face transformers
sentence-transformers==2.2.2  # Sentence embeddings
tokenizers==0.15.0            # Fast tokenizers

# ============================================
# NATURAL LANGUAGE PROCESSING
# ============================================
nltk==3.8.1                   # Natural language toolkit
langdetect==1.0.9             # Language detection

# ============================================
# RECOMMENDATION SYSTEMS
# ============================================
implicit==0.7.2               # Collaborative filtering (ALS)
surprise==1.1.3               # Recommendation algorithms

# ============================================
# DATABASE DRIVERS
# ============================================
# PostgreSQL
asyncpg==0.29.0               # Async PostgreSQL driver
psycopg2-binary==2.9.9        # Sync PostgreSQL driver

# MongoDB
motor==3.3.2                  # Async MongoDB driver
pymongo==4.6.1                # Sync MongoDB driver

# Cassandra
# cassandra-driver removed - interaction logging now uses PostgreSQL

# Weaviate
weaviate-client==4.4.1        # Weaviate vector DB client

# Redis
redis==5.0.1                  # Redis client

# ============================================
# HTTP CLIENT
# ============================================
httpx==0.26.0                 # Async HTTP client

# ============================================
# UTILITIES
# ============================================
python-dotenv==1.0.0          # Environment variables
pyyaml==6.0.1                 # YAML parsing
orjson==3.9.10                # Fast JSON serialization
python-dateutil==2.8.2        # Date utilities
structlog==24.1.0             # Structured logging

# ============================================
# MONITORING
# ============================================
prometheus-client==0.19.0     # Metrics

# ============================================
# TESTING
# ============================================
pytest==7.4.4                 # Testing framework
pytest-asyncio==0.23.3        # Async test support
pytest-cov==4.1.0             # Coverage reporting
faker==22.2.0                 # Fake data generation

# ============================================
# DEVELOPMENT
# ============================================
black==23.12.1                # Code formatting
flake8==7.0.0                 # Linting
mypy==1.8.0                   # Type checking
```

## 12.2 System Requirements

| Component | Minimum      | Recommended           |
| --------- | ------------ | --------------------- |
| Python    | 3.10         | 3.11+                 |
| RAM       | 4GB          | 8GB+                  |
| CPU       | 2 cores      | 4+ cores              |
| GPU       | Not required | NVIDIA with CUDA 12.1 |
| Disk      | 10GB         | 50GB                  |

## 12.3 Pre-trained Models to Download

```bash
# Sentiment model (English)
python -c "from transformers import pipeline; pipeline('sentiment-analysis')"

# Sentence transformer for embeddings
python -c "from sentence_transformers import SentenceTransformer; SentenceTransformer('all-MiniLM-L6-v2')"

# Arabic sentiment model (if needed)
python -c "from transformers import pipeline; pipeline('sentiment-analysis', model='CAMeL-Lab/bert-base-arabic-camelbert-mix-sentiment')"
```

---

# 13. Environment Configuration

## 13.1 Complete .env File

```bash
# ============================================
# APPLICATION
# ============================================
APP_NAME=ml-service
APP_ENV=development
APP_DEBUG=true
APP_PORT=8000
APP_HOST=0.0.0.0
LOG_LEVEL=INFO

# ============================================
# POSTGRESQL (Read-Only)
# ============================================
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=ecommerce_db
POSTGRES_USER=ml_service_readonly
POSTGRES_PASSWORD=your_secure_password
POSTGRES_MIN_CONNECTIONS=5
POSTGRES_MAX_CONNECTIONS=10

# ============================================
# MONGODB
# ============================================
MONGO_URI=mongodb://localhost:27017
MONGO_DB=ml_profiles
MONGO_MIN_POOL=10
MONGO_MAX_POOL=20

# ============================================
# WEAVIATE
# ============================================
WEAVIATE_URL=http://localhost:8080
WEAVIATE_API_KEY=your_weaviate_api_key

# ============================================
# REDIS
# ============================================
REDIS_URL=redis://localhost:6379/0
REDIS_MAX_CONNECTIONS=50

# ============================================
# SERVICE AUTHENTICATION
# ============================================
SERVICE_AUTH_TOKEN=your_service_to_service_token
LARAVEL_CALLBACK_URL=http://localhost:8080/api/ml-callback

# ============================================
# ML MODELS
# ============================================
SENTIMENT_MODEL=distilbert-base-uncased-finetuned-sst-2-english
EMBEDDING_MODEL=all-MiniLM-L6-v2
MODEL_CACHE_DIR=/app/models

# ============================================
# CACHING
# ============================================
PROFILE_CACHE_TTL=3600
RECOMMENDATION_CACHE_TTL=300
SIMILARITY_CACHE_TTL=86400

# ============================================
# RATE LIMITING
# ============================================
RATE_LIMIT_REQUESTS=100
RATE_LIMIT_WINDOW=60
```

---

# 14. Project Structure

```
ml-service/
â”‚
â”œâ”€â”€ main.py                          # FastAPI application entry point
â”œâ”€â”€ requirements.txt                 # Python dependencies
â”œâ”€â”€ Dockerfile                       # Container definition
â”œâ”€â”€ docker-compose.yml               # Local development stack
â”œâ”€â”€ .env.example                     # Environment template
â”œâ”€â”€ .gitignore
â”œâ”€â”€ README.md
â”œâ”€â”€ pytest.ini                       # Test configuration
â”‚
â”œâ”€â”€ config/                          # Configuration
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ settings.py                  # Pydantic settings
â”‚   â””â”€â”€ logging.py                   # Logging configuration
â”‚
â”œâ”€â”€ api/                             # API Layer
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ dependencies.py              # FastAPI dependencies
â”‚   â”œâ”€â”€ middleware.py                # Custom middleware
â”‚   â”‚
â”‚   â””â”€â”€ v1/                          # API Version 1
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ router.py                # Main router aggregator
â”‚       â”‚
â”‚       â”œâ”€â”€ endpoints/               # Route handlers
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â”œâ”€â”€ health.py            # Health check endpoints
â”‚       â”‚   â”œâ”€â”€ sentiment.py         # Sentiment analysis endpoints
â”‚       â”‚   â”œâ”€â”€ personality.py       # Personality endpoints
â”‚       â”‚   â””â”€â”€ recommendations.py   # Recommendation endpoints
â”‚       â”‚
â”‚       â””â”€â”€ schemas/                 # Request/Response schemas
â”‚           â”œâ”€â”€ __init__.py
â”‚           â”œâ”€â”€ common.py            # Shared schemas
â”‚           â”œâ”€â”€ sentiment.py
â”‚           â”œâ”€â”€ personality.py
â”‚           â””â”€â”€ recommendations.py
â”‚
â”œâ”€â”€ core/                            # Core Business Logic
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚
â”‚   â”œâ”€â”€ sentiment/                   # Sentiment Analysis Module
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ analyzer.py              # Main sentiment analyzer
â”‚   â”‚   â”œâ”€â”€ preprocessor.py          # Text preprocessing
â”‚   â”‚   â””â”€â”€ models.py                # Model loading and inference
â”‚   â”‚
â”‚   â”œâ”€â”€ personality/                 # Personality Classification
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ classifier.py            # Main classifier
â”‚   â”‚   â”œâ”€â”€ features.py              # Feature engineering
â”‚   â”‚   â”œâ”€â”€ rules.py                 # Rule-based classification
â”‚   â”‚   â””â”€â”€ clustering.py            # K-means clustering
â”‚   â”‚
â”‚   â”œâ”€â”€ recommendations/             # Recommendation Engine
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ engine.py                # Main recommendation engine
â”‚   â”‚   â”œâ”€â”€ collaborative.py         # Collaborative filtering
â”‚   â”‚   â”œâ”€â”€ content_based.py         # Content-based filtering
â”‚   â”‚   â”œâ”€â”€ personality_based.py     # Personality matching
â”‚   â”‚   â”œâ”€â”€ hybrid.py                # Score fusion
â”‚   â”‚   â””â”€â”€ cold_start.py            # Cold start strategies
â”‚   â”‚
â”‚   â””â”€â”€ vectors/                     # Vector Operations
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ embeddings.py            # Embedding generation
â”‚       â””â”€â”€ similarity.py            # Similarity computations
â”‚
â”œâ”€â”€ database/                        # Database Layer
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚
â”‚   â”œâ”€â”€ postgres/                    # PostgreSQL (Read-Only)
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ connection.py            # Connection pool
â”‚   â”‚   â””â”€â”€ repositories/
â”‚   â”‚       â”œâ”€â”€ user_repository.py
â”‚   â”‚       â”œâ”€â”€ product_repository.py
â”‚   â”‚       â””â”€â”€ order_repository.py
â”‚   â”‚
â”‚   â”œâ”€â”€ mongodb/                     # MongoDB
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ connection.py            # Motor async client
â”‚   â”‚   â””â”€â”€ collections/
â”‚   â”‚       â”œâ”€â”€ profiles.py
â”‚   â”‚       â””â”€â”€ sentiment_logs.py
â”‚   â”‚
â”‚   â”œâ”€â”€ weaviate/                    # Weaviate Vector DB
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ client.py
â”‚   â”‚   â””â”€â”€ operations.py
â”‚   â”‚
â”‚   â”œâ”€â”€ cassandra/                   # Cassandra
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ connection.py
â”‚   â”‚
â”‚   â””â”€â”€ redis/                       # Redis Cache
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ client.py
â”‚
â”œâ”€â”€ services/                        # Service Layer
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ sentiment_service.py
â”‚   â”œâ”€â”€ personality_service.py
â”‚   â””â”€â”€ recommendation_service.py
â”‚
â”œâ”€â”€ models/                          # ML Models
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ model_loader.py
â”‚   â””â”€â”€ pretrained/                  # Downloaded models
â”‚       â””â”€â”€ .gitkeep
â”‚
â”œâ”€â”€ utils/                           # Utilities
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ text.py
â”‚   â””â”€â”€ validators.py
â”‚
â”œâ”€â”€ tests/                           # Tests
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ conftest.py                  # Pytest fixtures
â”‚   â”œâ”€â”€ unit/
â”‚   â”‚   â”œâ”€â”€ test_sentiment.py
â”‚   â”‚   â”œâ”€â”€ test_personality.py
â”‚   â”‚   â””â”€â”€ test_recommendations.py
â”‚   â”œâ”€â”€ integration/
â”‚   â”‚   â””â”€â”€ test_api.py
â”‚   â””â”€â”€ fixtures/
â”‚       â””â”€â”€ sample_data.json
â”‚
â””â”€â”€ scripts/                         # Utility scripts
    â”œâ”€â”€ init_databases.py
    â”œâ”€â”€ seed_data.py
    â””â”€â”€ train_models.py
```

---

# 15. Integration with Laravel

## 15.1 Laravel MLService Class

```php
<?php
// app/Services/MLService.php

namespace App\Services;

use Illuminate\Support\Facades\Http;
use Illuminate\Support\Facades\Cache;
use Illuminate\Support\Facades\Log;

class MLService
{
    private string $baseUrl;
    private string $authToken;
    private int $timeout;

    public function __construct()
    {
        $this->baseUrl = config('services.ml.url', 'http://localhost:8000');
        $this->authToken = config('services.ml.token');
        $this->timeout = config('services.ml.timeout', 30);
    }

    /**
     * Analyze sentiment of a text
     */
    public function analyzeSentiment(
        string $text,
        int $userId,
        int $productId,
        bool $storeResult = true
    ): array {
        return $this->post('/api/v1/sentiment/analyze', [
            'text' => $text,
            'user_id' => $userId,
            'product_id' => $productId,
            'store_result' => $storeResult,
        ]);
    }

    /**
     * Get user personality profile
     */
    public function getUserProfile(int $userId): array
    {
        $cacheKey = "ml_profile_{$userId}";

        return Cache::remember($cacheKey, 3600, function () use ($userId) {
            return $this->get("/api/v1/personality/profile/{$userId}");
        });
    }

    /**
     * Trigger profile update after user activity
     */
    public function updateUserProfile(int $userId, string $trigger = 'activity'): array
    {
        $result = $this->post('/api/v1/personality/update', [
            'user_id' => $userId,
            'trigger' => $trigger,
        ]);

        // Invalidate cache
        Cache::forget("ml_profile_{$userId}");
        Cache::forget("ml_recommendations_{$userId}");

        return $result;
    }

    /**
     * Get personalized recommendations
     */
    public function getRecommendations(
        int $userId,
        int $limit = 10,
        string $context = 'default'
    ): array {
        $cacheKey = "ml_recommendations_{$userId}_{$context}_{$limit}";

        return Cache::remember($cacheKey, 300, function () use ($userId, $limit, $context) {
            return $this->get("/api/v1/recommendations/{$userId}", [
                'limit' => $limit,
                'context' => $context,
            ]);
        });
    }

    /**
     * Get similar products
     */
    public function getSimilarProducts(int $productId, int $limit = 5): array
    {
        $cacheKey = "ml_similar_{$productId}_{$limit}";

        return Cache::remember($cacheKey, 86400, function () use ($productId, $limit) {
            return $this->get("/api/v1/recommendations/similar/{$productId}", [
                'limit' => $limit,
            ]);
        });
    }

    /**
     * Submit recommendation feedback
     */
    public function submitFeedback(
        int $userId,
        int $productId,
        string $action
    ): array {
        return $this->post('/api/v1/recommendations/feedback', [
            'user_id' => $userId,
            'product_id' => $productId,
            'action' => $action,
            'timestamp' => now()->toIso8601String(),
        ]);
    }

    /**
     * Check ML service health
     */
    public function healthCheck(): bool
    {
        try {
            $response = $this->get('/health');
            return $response['status'] === 'ok';
        } catch (\Exception $e) {
            return false;
        }
    }

    private function get(string $endpoint, array $query = []): array
    {
        $response = Http::timeout($this->timeout)
            ->withHeaders(['X-Service-Auth' => $this->authToken])
            ->get($this->baseUrl . $endpoint, $query);

        return $response->json()['data'] ?? [];
    }

    private function post(string $endpoint, array $data = []): array
    {
        $response = Http::timeout($this->timeout)
            ->withHeaders(['X-Service-Auth' => $this->authToken])
            ->post($this->baseUrl . $endpoint, $data);

        return $response->json()['data'] ?? [];
    }
}
```

## 15.2 Controller Integration

```php
<?php
// app/Http/Controllers/ReviewController.php

namespace App\Http\Controllers;

use App\Models\Review;
use App\Services\MLService;
use Illuminate\Http\Request;

class ReviewController extends Controller
{
    public function __construct(
        private MLService $mlService
    ) {}

    public function store(Request $request)
    {
        $validated = $request->validate([
            'product_id' => 'required|exists:products,id',
            'rating' => 'required|integer|min:1|max:5',
            'comment' => 'required|string|min:10',
        ]);

        // Create review
        $review = Review::create([
            'user_id' => auth()->id(),
            'product_id' => $validated['product_id'],
            'rating' => $validated['rating'],
            'comment' => $validated['comment'],
        ]);

        // Analyze sentiment
        try {
            $sentiment = $this->mlService->analyzeSentiment(
                $review->comment,
                $review->user_id,
                $review->product_id
            );

            $review->update([
                'sentiment_score' => $sentiment['sentiment']['score'],
                'sentiment_label' => $sentiment['sentiment']['label'],
            ]);

            // Update user profile in background
            dispatch(function () use ($review) {
                $this->mlService->updateUserProfile($review->user_id, 'new_review');
            })->afterResponse();

        } catch (\Exception $e) {
            Log::warning('Sentiment analysis failed', ['error' => $e->getMessage()]);
        }

        return response()->json(['message' => 'Review submitted', 'data' => $review], 201);
    }
}
```

## 15.3 Laravel Configuration

```php
<?php
// config/services.php

return [
    // ... other services

    'ml' => [
        'url' => env('ML_SERVICE_URL', 'http://localhost:8000'),
        'token' => env('ML_SERVICE_TOKEN'),
        'timeout' => env('ML_SERVICE_TIMEOUT', 30),
    ],
];
```

## 15.4 Laravel Routes

```php
<?php
// routes/api.php

use App\Http\Controllers\ReviewController;
use App\Http\Controllers\RecommendationController;

Route::middleware('auth:sanctum')->group(function () {
    Route::post('/reviews', [ReviewController::class, 'store']);
    Route::get('/recommendations', [RecommendationController::class, 'index']);
    Route::get('/recommendations/similar/{product}', [RecommendationController::class, 'similar']);
    Route::post('/recommendations/feedback', [RecommendationController::class, 'feedback']);
});
```

---

# 16. Machine Learning Models

## 16.1 Sentiment Model Implementation

```python
# core/sentiment/models.py

from transformers import AutoTokenizer, AutoModelForSequenceClassification
import torch
from functools import lru_cache

class SentimentModel:
    def __init__(self, model_name: str = "distilbert-base-uncased-finetuned-sst-2-english"):
        self.device = torch.device("cuda" if torch.cuda.is_available() else "cpu")
        self.tokenizer = AutoTokenizer.from_pretrained(model_name)
        self.model = AutoModelForSequenceClassification.from_pretrained(model_name)
        self.model.to(self.device)
        self.model.eval()

    @torch.no_grad()
    def predict(self, text: str) -> dict:
        inputs = self.tokenizer(
            text,
            return_tensors="pt",
            truncation=True,
            max_length=512
        ).to(self.device)

        outputs = self.model(**inputs)
        probs = torch.nn.functional.softmax(outputs.logits, dim=-1)[0]

        labels = ["negative", "positive"]
        predicted = probs.argmax().item()

        return {
            "label": labels[predicted],
            "score": float(probs[predicted]),
            "confidence": float(probs[predicted]),
            "raw_scores": {l: float(p) for l, p in zip(labels, probs)}
        }

    @torch.no_grad()
    def predict_batch(self, texts: list[str]) -> list[dict]:
        inputs = self.tokenizer(
            texts,
            return_tensors="pt",
            truncation=True,
            max_length=512,
            padding=True
        ).to(self.device)

        outputs = self.model(**inputs)
        all_probs = torch.nn.functional.softmax(outputs.logits, dim=-1)

        results = []
        labels = ["negative", "positive"]

        for probs in all_probs:
            predicted = probs.argmax().item()
            results.append({
                "label": labels[predicted],
                "score": float(probs[predicted]),
                "raw_scores": {l: float(p) for l, p in zip(labels, probs)}
            })

        return results


@lru_cache()
def get_sentiment_model() -> SentimentModel:
    return SentimentModel()
```

## 16.2 Embedding Model Implementation

```python
# core/vectors/embeddings.py

from sentence_transformers import SentenceTransformer
import numpy as np
from functools import lru_cache

class EmbeddingModel:
    def __init__(self, model_name: str = "all-MiniLM-L6-v2"):
        self.model = SentenceTransformer(model_name)

    def embed_text(self, text: str) -> np.ndarray:
        return self.model.encode(text, convert_to_numpy=True)

    def embed_texts(self, texts: list[str]) -> np.ndarray:
        return self.model.encode(texts, convert_to_numpy=True, batch_size=32)

    def embed_product(self, product: dict) -> np.ndarray:
        text = f"{product['name']} {product['description']} {product['category']} {product.get('brand', '')}"
        return self.embed_text(text)

    def similarity(self, vec1: np.ndarray, vec2: np.ndarray) -> float:
        return float(np.dot(vec1, vec2) / (np.linalg.norm(vec1) * np.linalg.norm(vec2)))


@lru_cache()
def get_embedding_model() -> EmbeddingModel:
    return EmbeddingModel()
```

## 16.3 Collaborative Filtering Implementation

```python
# core/recommendations/collaborative.py

from implicit.als import AlternatingLeastSquares
from scipy.sparse import csr_matrix
import pickle

class CollaborativeFilter:
    def __init__(self, factors: int = 64, iterations: int = 20):
        self.model = AlternatingLeastSquares(
            factors=factors,
            iterations=iterations,
            use_gpu=False
        )
        self.user_mapping = {}
        self.item_mapping = {}
        self.reverse_item_mapping = {}

    def fit(self, interactions: list[tuple[int, int, float]]):
        users = sorted(set(i[0] for i in interactions))
        items = sorted(set(i[1] for i in interactions))

        self.user_mapping = {u: i for i, u in enumerate(users)}
        self.item_mapping = {item: i for i, item in enumerate(items)}
        self.reverse_item_mapping = {i: item for item, i in self.item_mapping.items()}

        rows = [self.user_mapping[i[0]] for i in interactions]
        cols = [self.item_mapping[i[1]] for i in interactions]
        data = [i[2] for i in interactions]

        matrix = csr_matrix((data, (rows, cols)), shape=(len(users), len(items)))
        self.model.fit(matrix)

    def recommend(self, user_id: int, n: int = 10) -> list[tuple[int, float]]:
        if user_id not in self.user_mapping:
            return []

        user_idx = self.user_mapping[user_id]
        item_indices, scores = self.model.recommend(user_idx, user_items=None, N=n)

        return [
            (self.reverse_item_mapping[idx], float(score))
            for idx, score in zip(item_indices, scores)
        ]

    def similar_items(self, item_id: int, n: int = 10) -> list[tuple[int, float]]:
        if item_id not in self.item_mapping:
            return []

        item_idx = self.item_mapping[item_id]
        similar_indices, scores = self.model.similar_items(item_idx, N=n + 1)

        return [
            (self.reverse_item_mapping[idx], float(score))
            for idx, score in zip(similar_indices, scores)
            if idx != item_idx
        ][:n]

    def save(self, path: str):
        with open(path, 'wb') as f:
            pickle.dump(self.__dict__, f)

    def load(self, path: str):
        with open(path, 'rb') as f:
            self.__dict__.update(pickle.load(f))
```

---

# 17. Performance Considerations

## 17.1 Caching Strategy

| Cache Layer     | Data                | TTL                  |
| --------------- | ------------------- | -------------------- |
| In-Memory (LRU) | Model instances     | Application lifetime |
| Redis           | User profiles       | 1 hour               |
| Redis           | Recommendations     | 5 minutes            |
| Redis           | Similarity results  | 24 hours             |
| Redis           | Rate limit counters | 1 minute             |

## 17.2 Response Time Targets

| Endpoint                     | Target | P95   |
| ---------------------------- | ------ | ----- |
| Health Check                 | <10ms  | 5ms   |
| Get Profile (cached)         | <50ms  | 35ms  |
| Get Profile (miss)           | <200ms | 150ms |
| Sentiment Analysis           | <300ms | 200ms |
| Get Recommendations (cached) | <50ms  | 40ms  |
| Get Recommendations (miss)   | <500ms | 400ms |

## 17.3 Optimization Tips

1. **Batch Processing**: Use `predict_batch()` for multiple items
2. **Pre-computation**: Nightly jobs for embeddings and recommendations
3. **Async Operations**: Non-blocking database calls
4. **Model Caching**: Load once at startup with `@lru_cache()`
5. **Connection Pooling**: Use pools for all database connections

---

# 18. Security Considerations

## 18.1 Security Layers

| Layer            | Implementation                  |
| ---------------- | ------------------------------- |
| Network          | ML Service not exposed publicly |
| Authentication   | Service-to-service token        |
| Input Validation | Pydantic schemas                |
| Rate Limiting    | 100 requests/minute             |
| Data Protection  | No PII stored, only user IDs    |

## 18.2 Authentication Middleware

```python
# api/middleware.py

from fastapi import Request, HTTPException
import hmac

class AuthenticationMiddleware:
    EXCLUDED_PATHS = {"/health", "/health/ready", "/metrics"}

    async def __call__(self, request: Request, call_next):
        if request.url.path in self.EXCLUDED_PATHS:
            return await call_next(request)

        auth_header = request.headers.get("X-Service-Auth")
        expected = settings.service_auth_token

        if not auth_header or not hmac.compare_digest(auth_header, expected):
            raise HTTPException(status_code=401, detail="Unauthorized")

        return await call_next(request)
```

---

# 19. Testing Strategy

## 19.1 Test Categories

| Category    | Coverage | Focus                                  |
| ----------- | -------- | -------------------------------------- |
| Unit Tests  | 70%      | Model predictions, feature engineering |
| Integration | 25%      | API endpoints, database operations     |
| E2E Tests   | 5%       | Full pipeline tests                    |

## 19.2 Example Tests

```python
# tests/unit/test_sentiment.py

import pytest
from core.sentiment.analyzer import SentimentAnalyzer

class TestSentimentAnalyzer:
    @pytest.fixture
    def analyzer(self):
        return SentimentAnalyzer()

    def test_positive_sentiment(self, analyzer):
        result = analyzer.analyze("This product is amazing!")
        assert result["label"] == "positive"
        assert result["score"] > 0.7

    def test_negative_sentiment(self, analyzer):
        result = analyzer.analyze("Terrible quality.")
        assert result["label"] == "negative"
        assert result["score"] > 0.7
```

## 19.3 Running Tests

```bash
pytest                              # All tests
pytest --cov=. --cov-report=html    # With coverage
pytest tests/unit/                  # Unit only
pytest -k "sentiment"               # Pattern match
```

---

# 20. Deployment Guide

## 20.1 Docker Compose (Development)

```yaml
version: "3.8"

services:
  ml-service:
    build: .
    ports:
      - "8000:8000"
    environment:
      - POSTGRES_HOST=postgres
      - MONGO_URI=mongodb://mongo:27017
      - WEAVIATE_URL=http://weaviate:8080
      - REDIS_URL=redis://redis:6379/0
    depends_on:
      - postgres
      - mongo
      - weaviate
      - cassandra
      - redis

  postgres:
    image: postgres:15
    environment:
      - POSTGRES_DB=ecommerce

  mongo:
    image: mongo:7

  weaviate:
    image: semitechnologies/weaviate:1.23.0

  cassandra:
    image: cassandra:4.1

  redis:
    image: redis:7-alpine
```

## 20.2 Production Dockerfile

```dockerfile
FROM python:3.11-slim

WORKDIR /app

RUN apt-get update && apt-get install -y libpq5 && rm -rf /var/lib/apt/lists/*

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Download models during build
RUN python -c "from transformers import pipeline; pipeline('sentiment-analysis')"
RUN python -c "from sentence_transformers import SentenceTransformer; SentenceTransformer('all-MiniLM-L6-v2')"

COPY . .

EXPOSE 8000
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000", "--workers", "4"]
```

---

# 21. Future Enhancements

## 21.1 Roadmap

**Phase 2 (3-6 months):**

- Real-time recommendations via WebSocket
- A/B testing framework
- Aspect-based sentiment analysis
- Explainable AI ("why this recommendation?")

**Phase 3 (6-12 months):**

- Multi-language support (Arabic, French)
- Image-based recommendations (visual similarity)
- Reinforcement learning for ranking

**Phase 4 (12+ months):**

- Conversational recommendations (chatbot)
- Cross-platform tracking
- AR/VR product visualization

---

# Appendix: Quick Reference

## API Endpoints

```
GET  /health                                â†’ Health check
POST /api/v1/sentiment/analyze              â†’ Analyze sentiment
GET  /api/v1/personality/profile/{user_id}  â†’ Get user profile
GET  /api/v1/recommendations/{user_id}      â†’ Get recommendations
GET  /api/v1/recommendations/similar/{id}   â†’ Similar products
POST /api/v1/recommendations/feedback       â†’ Submit feedback
```

## Key Technologies

| Component  | Technology                                      |
| ---------- | ----------------------------------------------- |
| Framework  | FastAPI                                         |
| ML         | PyTorch, Transformers, scikit-learn             |
| Databases  | PostgreSQL, MongoDB, Weaviate, Redis |
| Deployment | Docker, uvicorn                                 |

## Database Purpose

| Database   | Stores                           |
| ---------- | -------------------------------- |
| PostgreSQL | Users, Products, Orders, Reviews |
| MongoDB    | User profiles, ML features       |
| Weaviate   | Vector embeddings                |
| PostgreSQL | User interactions (+ business data) |
| Redis      | Cache, sessions                  |

---

**Document Version:** 1.0  
**Last Updated:** January 2025  
**Status:** Ready for Implementation
