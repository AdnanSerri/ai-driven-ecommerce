generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id              BigInt    @id @default(autoincrement())
  name            String    @db.VarChar(255)
  email           String    @unique(map: "users_email_unique") @db.VarChar(255)
  emailVerifiedAt DateTime? @map("email_verified_at") @db.Timestamp(0)
  password        String    @db.VarChar(255)
  rememberToken   String?   @map("remember_token") @db.VarChar(100)
  createdAt       DateTime? @map("created_at") @db.Timestamp(0)
  updatedAt       DateTime? @map("updated_at") @db.Timestamp(0)
  isAdmin         Boolean   @default(false) @map("is_admin")
  phone           String?   @db.VarChar(255)
  avatarUrl       String?   @map("avatar_url") @db.VarChar(255)
  dateOfBirth     DateTime? @map("date_of_birth") @db.Date
  preferences     Json?     @db.Json

  addresses Address[]
  carts     Cart[]
  orders    Order[]
  reviews   Review[]
  wishlists Wishlist[]

  @@map("users")
}

model Product {
  id                BigInt   @id @default(autoincrement())
  name              String   @db.VarChar(255)
  sku               String?  @unique @db.VarChar(100)
  description       String
  price             Decimal  @db.Decimal(10, 2)
  categoryId        BigInt   @map("category_id")
  imageUrl          String?  @map("image_url") @db.VarChar(255)
  createdAt         DateTime @default(now()) @map("created_at") @db.Timestamp(0)
  stock             Int      @default(0)
  lowStockThreshold Int      @default(10) @map("low_stock_threshold")
  trackStock        Boolean  @default(true) @map("track_stock")

  category   Category       @relation(fields: [categoryId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "products_category_id_foreign")
  cartItems  CartItem[]
  images     ProductImage[]
  reviews    Review[]
  wishlists  Wishlist[]
  orderItems OrderItem[]

  @@map("products")
}

model Category {
  id        BigInt    @id @default(autoincrement())
  name      String    @db.VarChar(255)
  parentId  BigInt?   @map("parent_id")
  createdAt DateTime? @map("created_at") @db.Timestamp(0)
  updatedAt DateTime? @map("updated_at") @db.Timestamp(0)

  parent   Category?  @relation("CategoryToCategory", fields: [parentId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "categories_parent_id_foreign")
  children Category[] @relation("CategoryToCategory")
  products Product[]

  @@map("categories")
}

model Review {
  id                  BigInt    @id @default(autoincrement())
  userId              BigInt    @map("user_id")
  productId           BigInt    @map("product_id")
  rating              Int       @db.SmallInt
  comment             String
  sentimentScore      Decimal?  @map("sentiment_score") @db.Decimal(5, 4)
  sentimentLabel      String?   @map("sentiment_label") @db.VarChar(20)
  sentimentConfidence Decimal?  @map("sentiment_confidence") @db.Decimal(5, 4)
  sentimentAnalyzedAt DateTime? @map("sentiment_analyzed_at") @db.Timestamp(0)
  createdAt           DateTime  @default(now()) @map("created_at") @db.Timestamp(0)

  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "reviews_user_id_foreign")
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "reviews_product_id_foreign")

  @@map("reviews")
}

model Address {
  id           BigInt   @id @default(autoincrement())
  userId       BigInt   @map("user_id")
  label        String?  @db.VarChar(255)
  type         String   @db.VarChar(255)
  firstName    String   @map("first_name") @db.VarChar(255)
  lastName     String   @map("last_name") @db.VarChar(255)
  phone        String?  @db.VarChar(255)
  addressLine1 String   @map("address_line_1") @db.VarChar(255)
  addressLine2 String?  @map("address_line_2") @db.VarChar(255)
  city         String   @db.VarChar(255)
  state        String?  @db.VarChar(255)
  postalCode   String   @map("postal_code") @db.VarChar(255)
  country      String   @default("US") @db.VarChar(2)
  isDefault    Boolean  @default(false) @map("is_default")
  createdAt    DateTime @default(now()) @map("created_at") @db.Timestamp(0)

  user           User    @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "addresses_user_id_foreign")
  shippingOrders Order[] @relation("OrderShippingAddress")
  billingOrders  Order[] @relation("OrderBillingAddress")

  @@map("addresses")
}

model Cart {
  id        BigInt    @id @default(autoincrement())
  userId    BigInt    @map("user_id")
  createdAt DateTime? @map("created_at") @db.Timestamp(0)
  updatedAt DateTime? @map("updated_at") @db.Timestamp(0)

  user  User       @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "carts_user_id_foreign")
  items CartItem[]

  @@map("carts")
}

model CartItem {
  id        BigInt   @id @default(autoincrement())
  cartId    BigInt   @map("cart_id")
  productId BigInt   @map("product_id")
  quantity  Int      @default(1)
  addedAt   DateTime @default(now()) @map("added_at") @db.Timestamp(0)

  cart    Cart    @relation(fields: [cartId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "cart_items_cart_id_foreign")
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "cart_items_product_id_foreign")

  @@unique([cartId, productId], map: "cart_items_cart_id_product_id_unique")
  @@map("cart_items")
}

model Order {
  id                BigInt    @id @default(autoincrement())
  orderNumber       String    @unique(map: "orders_order_number_unique") @map("order_number") @db.VarChar(255)
  userId            BigInt    @map("user_id")
  shippingAddressId BigInt?   @map("shipping_address_id")
  billingAddressId  BigInt?   @map("billing_address_id")
  status            String    @default("pending") @db.VarChar(255)
  subtotal          Decimal   @db.Decimal(10, 2)
  discount          Decimal   @default(0) @db.Decimal(10, 2)
  tax               Decimal   @default(0) @db.Decimal(10, 2)
  total             Decimal   @db.Decimal(10, 2)
  notes             String?
  orderedAt         DateTime  @default(now()) @map("ordered_at") @db.Timestamp(0)
  confirmedAt       DateTime? @map("confirmed_at") @db.Timestamp(0)
  shippedAt         DateTime? @map("shipped_at") @db.Timestamp(0)
  deliveredAt       DateTime? @map("delivered_at") @db.Timestamp(0)
  cancelledAt       DateTime? @map("cancelled_at") @db.Timestamp(0)

  items           OrderItem[]
  shippingAddress Address?    @relation("OrderShippingAddress", fields: [shippingAddressId], references: [id], onUpdate: NoAction, map: "orders_shipping_address_id_foreign")
  billingAddress  Address?    @relation("OrderBillingAddress", fields: [billingAddressId], references: [id], onUpdate: NoAction, map: "orders_billing_address_id_foreign")
  user            User        @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "orders_user_id_foreign")

  @@map("orders")
}

model OrderItem {
  id           BigInt  @id @default(autoincrement())
  orderId      BigInt  @map("order_id")
  productId    BigInt  @map("product_id")
  productName  String  @map("product_name") @db.VarChar(255)
  productPrice Decimal @map("product_price") @db.Decimal(10, 2)
  quantity     Int
  subtotal     Decimal @db.Decimal(10, 2)

  order   Order   @relation(fields: [orderId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "order_items_order_id_foreign")
  product Product @relation(fields: [productId], references: [id], onUpdate: NoAction, map: "order_items_product_id_foreign")

  @@map("order_items")
}

model ProductImage {
  id        BigInt   @id @default(autoincrement())
  productId BigInt   @map("product_id")
  url       String   @db.VarChar(255)
  altText   String?  @map("alt_text") @db.VarChar(255)
  isPrimary Boolean  @default(false) @map("is_primary")
  sortOrder Int      @default(0) @map("sort_order")
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamp(0)

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "product_images_product_id_foreign")

  @@map("product_images")
}

model Wishlist {
  id        BigInt   @id @default(autoincrement())
  userId    BigInt   @map("user_id")
  productId BigInt   @map("product_id")
  addedAt   DateTime @default(now()) @map("added_at") @db.Timestamp(0)

  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "wishlists_user_id_foreign")
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "wishlists_product_id_foreign")

  @@unique([userId, productId], map: "wishlists_user_id_product_id_unique")
  @@map("wishlists")
}

model UserInteraction {
  id              String   @id @db.Uuid
  userId          BigInt   @map("user_id")
  productId       BigInt   @map("product_id")
  interactionType String   @map("interaction_type")
  durationSeconds Int?     @default(0) @map("duration_seconds")
  metadata        Json?
  createdAt       DateTime @default(now()) @map("created_at") @db.Timestamptz(6)

  @@index([productId, interactionType, createdAt(sort: Desc)], map: "idx_ui_product_type_created")
  @@index([userId, createdAt(sort: Desc)], map: "idx_ui_user_created")
  @@index([userId, interactionType], map: "idx_ui_user_type")
  @@map("user_interactions")
}

model UserNegativeFeedback {
  id        BigInt   @id @default(autoincrement())
  userId    BigInt   @map("user_id")
  productId BigInt   @map("product_id")
  reason    String?  @db.VarChar(50)
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(6)

  @@unique([userId, productId], map: "user_negative_feedback_user_id_product_id_unique")
  @@index([userId], map: "idx_unf_user_id")
  @@map("user_negative_feedback")
}

// Laravel internal tables - kept for compatibility, not used by NestJS
model PersonalAccessToken {
  id            BigInt    @id @default(autoincrement())
  tokenableType String    @map("tokenable_type") @db.VarChar(255)
  tokenableId   BigInt    @map("tokenable_id")
  name          String
  token         String    @unique(map: "personal_access_tokens_token_unique") @db.VarChar(64)
  abilities     String?
  lastUsedAt    DateTime? @map("last_used_at") @db.Timestamp(0)
  expiresAt     DateTime? @map("expires_at") @db.Timestamp(0)
  createdAt     DateTime? @map("created_at") @db.Timestamp(0)
  updatedAt     DateTime? @map("updated_at") @db.Timestamp(0)

  @@index([expiresAt], map: "personal_access_tokens_expires_at_index")
  @@index([tokenableType, tokenableId], map: "personal_access_tokens_tokenable_type_tokenable_id_index")
  @@map("personal_access_tokens")
}

model Migration {
  id        Int    @id @default(autoincrement())
  migration String @db.VarChar(255)
  batch     Int

  @@map("migrations")
}

model FailedJob {
  id         BigInt   @id @default(autoincrement())
  uuid       String   @unique(map: "failed_jobs_uuid_unique") @db.VarChar(255)
  connection String
  queue      String
  payload    String
  exception  String
  failedAt   DateTime @default(now()) @map("failed_at") @db.Timestamp(0)

  @@map("failed_jobs")
}

model Session {
  id           String  @id @db.VarChar(255)
  userId       BigInt? @map("user_id")
  ipAddress    String? @map("ip_address") @db.VarChar(45)
  userAgent    String? @map("user_agent")
  payload      String
  lastActivity Int     @map("last_activity")

  @@index([lastActivity], map: "sessions_last_activity_index")
  @@index([userId], map: "sessions_user_id_index")
  @@map("sessions")
}

model Cache {
  key        String @id @db.VarChar(255)
  value      String
  expiration Int

  @@map("cache")
}

model CacheLock {
  key        String @id @db.VarChar(255)
  owner      String @db.VarChar(255)
  expiration Int

  @@map("cache_locks")
}

model PasswordResetToken {
  email     String    @id @db.VarChar(255)
  token     String    @db.VarChar(255)
  createdAt DateTime? @map("created_at") @db.Timestamp(0)

  @@map("password_reset_tokens")
}

model Job {
  id          BigInt @id @default(autoincrement())
  queue       String @db.VarChar(255)
  payload     String
  attempts    Int    @db.SmallInt
  reservedAt  Int?   @map("reserved_at")
  availableAt Int    @map("available_at")
  createdAt   Int    @map("created_at")

  @@index([queue], map: "jobs_queue_index")
  @@map("jobs")
}

model JobBatch {
  id           String  @id @db.VarChar(255)
  name         String  @db.VarChar(255)
  totalJobs    Int     @map("total_jobs")
  pendingJobs  Int     @map("pending_jobs")
  failedJobs   Int     @map("failed_jobs")
  failedJobIds String  @map("failed_job_ids")
  options      String?
  cancelledAt  Int?    @map("cancelled_at")
  createdAt    Int     @map("created_at")
  finishedAt   Int?    @map("finished_at")

  @@map("job_batches")
}
